# 基于深度学习的动漫人物睫毛曲线自动生成研究

## 摘要
本研究提出基于多层感知机(MLP)的深度学习方案，用于动漫人物睫毛曲线自动生成。通过分析眼轮廓与睫毛的几何关系，建立端到端的预测模型。实验结果表明该方法能有效捕捉睫毛形态特征，平均误差5.02±2.81像素，为角色眼部制作提供高效自动化解决方案。

<img src="./doc/example.png" width="200"/>

## 1. 引言
在动漫人物设计中，眼部细节渲染对角色表现力具有重要影响。睫毛作为关键眼部特征，需与眼轮廓线精心协调，传统方式依赖动画师大量人工调整。本研究旨在利用深度学习技术实现睫毛曲线自动化生成，提升角色眼部制作效率。

## 2. 方法论

### 2.1 数据表示
本研究采用曲线参数化方法，将眼轮廓线(Curve A)与睫毛曲线(Curve B)统一参数表示。通过建立局部坐标系，将复杂空间关系分解为切向与法向分量，为深度学习模型提供归一化输入特征。

设$$\gamma_A(t)$$和$$\gamma_B(t)$$分别表示眼轮廓与睫毛曲线，其中$t \in [0,1]$为归一化弧长参数。曲线参数化表示为：

$$\gamma_A(t) = (x_A(t), y_A(t))$$
$$\gamma_B(t) = (x_B(t), y_B(t))$$

眼轮廓线任意点处的切向量$$T(t)$$与法向量$$N(t)$$计算为：

$$T(t) = \frac{\gamma_A'(t)}{|\gamma_A'(t)|}$$
$$N(t) = (-T_y(t), T_x(t))$$

<img src="./doc/curves_by_svg.png" width="500"/>

### 2.2 曲线参数化
定义参数方程：

$$
\begin{cases}
X = L_A \cdot s \\
Y = x_B(t(s)) \\
Z = y_B(t(s))
\end{cases}
$$

其中$L_A$为曲线A长度，$s$为归一化弧长参数，$t(s)$为曲线B对应参数值。

### 2.3 网络架构
模型采用多层感知机结构，前向传播过程为：

每层$l$的输出$$h^{(l)}$$计算为：

$$h^{(l)} = \text{ReLU}(W^{(l)}h^{(l-1)} + b^{(l)})$$

其中$$W^{(l)}$$和$$b^{(l)}$$为第$l$层权重与偏置。

最终输出层生成偏移量预测：

$$[\Delta s, \Delta n] = W^{(out)}h^{(L)} + b^{(out)}$$

其中$$\Delta s$$和$$\Delta n$$分别为切向与法向偏移量。

训练配置：
* 优化器：Adam
* 损失函数：
  $$L_{MSE} = \frac{1}{N}\sum_{i=1}^N(\hat{y}_i - y_i)^2$$
* 评估指标：
  $$MAE = \frac{1}{N}\sum_{i=1}^N|\hat{y}_i - y_i|$$

### 2.4 相对运动分析
通过弧长参数化与局部坐标系变换，建立曲线间相对位置关系的数学模型。曲线B上任一点位置可表示为曲线A局部坐标系下的：

$$\gamma_B(t) = \gamma_A(s) + \Delta s(s)T(s) + \Delta n(s)N(s)$$

其中$s$为曲线A对应参数值，$$(\Delta s, \Delta n)$$为预测偏移量。

<img src="./doc/relative_motion.png" width="500"/>

## 3. 实验结果与分析

### 3.1 训练数据生成
为增强模型泛化能力，训练数据进行了随机位移与缩放增强：

<img src="./doc/train_data.png" width="500"/>

### 3.2 定量评估
模型性能指标：
```
验证统计量：
平均误差：5.0212 ± 2.8087 像素
最小误差：1.8515 像素
最大误差：11.9900 像素
```

### 3.3 训练过程分析
损失函数与MAE收敛过程：

<img src="./doc/Model_Loss_MAE.png" width="500"/>

### 3.4 预测结果
模型在测试集上的预测效果：

<img src="./doc/test_result.png" width="500"/>

![](./doc/test_results.png)

## 4. 应用价值
研究成果可应用于：
1. 角色眼部制作流程自动化
2. 角色设计标准化
3. 新手动画师培训辅助
4. 批量角色处理

## 5. 技术实现

### 5.1 依赖项
- NumPy：数值计算
- TensorFlow：深度学习框架
- Matplotlib：数据可视化
- SciPy：科学计算
- svg.path：SVG路径处理

### 5.2 代码实现
核心研究内容实现在`research.ipynb`笔记本中，包含完整的数据处理、模型训练与评估流程。

## 6. 结论
本文提出的深度学习方法成功实现动漫人物睫毛自动生成，具有：
1. 精确捕捉眼轮廓与睫毛空间关系
2. 保持角色风格一致性
3. 显著提升制作效率
4. 为角色眼部制作提供可靠自动化工具

## 版权声明
 Kigland 团队，大过年的，水个报告而水。